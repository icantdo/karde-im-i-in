<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <title>Küçük Karaoke — Çok Şarkılı</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
  <h1>Küçük Karaoke</h1>

  <!-- Şarkı seçimi -->
  <div>
    <label>Şarkı:
      <select id="songSelect"></select>
    </label>
    <button id="prevBtn">‹ Önceki</button>
    <button id="nextBtn">Sonraki ›</button>
  </div>

  <!-- Oynatıcı -->
  <audio id="audio" preload="metadata" controls style="display:block; margin:10px 0;"></audio>

  <hr/>

  <!-- Sözler -->
  <div id="nowline"  style="font-size:28px; font-family:monospace; white-space:pre-wrap;"></div>
  <div id="nextline" style="opacity:.6; font-family:monospace; margin-top:8px;"></div>

  <hr/>

  <!-- Dosyadan ekle (geçici / bu sekme açık kaldığı sürece) -->
  <details>
    <summary><strong>Dosyadan ekle (geçici):</strong> MP3 + LRC yükle ve listeye ekle</summary>
    <div style="margin-top:8px;">
      <label>Başlık: <input id="addTitle" type="text" placeholder="Şarkı adı"/></label>
      <label style="margin-left:8px;">MP3/WAV: <input id="addAudio" type="file" accept="audio/*"/></label>
      <label style="margin-left:8px;">LRC: <input id="addLrc" type="file" accept=".lrc,.txt,text/plain"/></label>
      <button id="addBtn">Listeye ekle</button>
      <small style="display:block; margin-top:6px;">Not: Bu yöntemle eklenen şarkılar kalıcı değildir; sayfa yenilenince kaybolur.</small>
    </div>
  </details>

  <!-- === GÖMÜLÜ (KALICI) LRC BLOKLARI ===
       Buraya yeni şarkılar için yeni <script type="text/plain" id="lrc-..."> blokları ekleyebilirsin.
       ÖNEMLİ: LRC içinde "</script>" geçiyorsa, </ yerine <\/ yaz (tarayıcıya takılmamak için).
  -->

  <!-- ÖRNEK 1: Buraya kendi LRC’ni yapıştır (ve ../audio/ dosyana göre src yolunu altta JS’te belirt) -->
  <script id="lrc-example1" type="text/plain">
[00:15.00]I wanna rock right now
[00:16.90]I wanna, I wanna rock right now
[00:18.60]I wanna, I wanna rock right now
[00:20.40]Now, now, rock right now
[00:22.50]I wanna, I wanna rock right now
[00:24.20]I wanna, I wanna rock right now
[00:26.20]I wanna, I wanna rock right now
[00:30.90]I wanna da-, I wanna dance in the lights
[00:34.50]I wanna ro-, I wanna rock yo' body right
[00:38.60]I wanna go, I wanna go for a ride
[00:42.00]Hop in the music and rock yo' body right
[00:46.10]Rock that body, c'mon c'mon, rock that body (Rock yo' body)
[00:49.00]Rock that body, c'mon c'mon, rock that body
[00:51.00]Rock that body, c'mon c'mon, rock that body (Rock yo' body)
[00:53.70]Rock that body, c'mon c'mon, rock that body
[00:56.80]Rock that body, c'mon c'mon, rock that body
[01:00.30]Let me see your body rock
[01:02.20]Shakin' from the bottom and top
[01:04.00]Freak to what the DJ drop
[01:05.90]We be the ones to make it hot (to make it hot)
[01:08.80]Electric shock, energy like a billion watts
[01:11.70]Space be booming, the speakers pop
[01:13.60]Galactic comb and Mr. Spock
[01:15.80]We bumping in your parking lot
[01:17.70]When you comin up in the spot
[01:19.40]Don't bring nothin' we call P. Dot
[01:21.40]Cause we burning around the clock
[01:23.30]Hit the lights and then turn them off
[01:25.20]If you bring that don't make you stop
[01:27.00]Like the jungle, we run the block
[01:28.90]No-one rolling the way we rock, way we rock
[01:31.90]I wanna rock right now
[01:33.40]I wanna, I wanna rock right now
[01:35.30]I wanna, I wanna rock right now
[01:39.80]I wanna da-, I wanna dance in the lights
[01:43.50]I wanna ro-, I wanna rock yo' body right
[01:47.60]I wanna go, I wanna go for a ride
[01:51.40]Hop in the music and rock yo' body right
[01:55.00]Rock that body, c'mon c'mon, rock that body (Rock that body)
[01:58.80]Rock that body, c'mon c'mon, rock that body
[02:02.60]Rock that body, c'mon c'mon, rock that body (Rock yo' body)
[02:05.60]Rock that body, c'mon c'mon, rock that body
[02:09.80]Superfly ladies, all of my superfly ladies
[02:13.30]All of my superfly ladies
[02:15.20]All of my super, superfly ladies
[02:17.80]Yeah, you could be big boned
[02:20.00]Long as you feel like you on
[02:21.80]You could be the model type, skinny with no appetite
[02:25.70]Short, stacked, black or white
[02:27.60]Long as you do what you like
[02:29.40]Body outta sight, body, body outta sight
[02:32.60]Yeah
[02:32.80]She does the two step, and the tongue drop
[02:35.00]She does the cabbage patch, and the bus stop
[02:36.90]She like electro, she love hip-hop
[02:38.70]She like the reggae, she feel punk rock
[02:40.70]She love samba, and the mambo
[02:42.60]She like to breakdance, and calypso
[02:44.50]Get a lil' crazy, get a lil' stupid
[02:46.60]Get a lil' crazy, crazy, crazy
[02:48.80]I wanna da-, I wanna dance in the lights
[02:52.30]I wanna ro-, I wanna rock yo' body right
[02:56.70]I wanna go, I wanna go for a ride
[03:00.10]Hop in the music and rock yo' body right
[03:08.80]Rock yo' body right (Sat upright)
[03:16.60]Rock yo' body right (Sat upright)
[03:22.50]C'mon, yeah
[03:27.40]Rock that body, c'mon c'mon, rock that body
[03:30.30]C'mon, yeah
[03:31.20]Rock that body, c'mon c'mon, rock that body
[03:34.20]Go oh oh oh, oh-oh-oh
[03:38.40]Let go oh oh oh, oh-oh-oh
[03:42.00]Let go oh oh oh, oh-oh-oh
[03:45.70]Let go oh oh oh, oh-oh-oh
[03:49.90]I wanna, I wanna rock right now
[03:53.10]I wanna, I wanna rock
[03:55.00]I wanna, I wanna rock
[03:57.20]Let go oh oh oh, oh-oh-oh
[04:00.00]I wanna, I wanna rock
[04:03.00]I wanna, I wanna rock
[04:05.10]Let go oh oh oh, oh-oh-oh
[04:09.20]Let go oh oh oh, oh-oh-oh
[04:12.70]I wanna, I wanna rock right now
[04:14.60]I wanna, I wanna rock right now
[04:16.60]I wanna, I wanna rock right now
[04:18.50]Now, now, rock right now
[04:20.50]I wanna, I wanna rock right now
[04:22.30]I wanna, I wanna rock right now
[04:24.40]I wanna, I wanna rock right now
[04:29.50]by RentAnAdviser.com
  </script>

  <!-- ÖRNEK 2: İstersen ikinci bir gömülü şarkı -->
  <script id="lrc-example2" type="text/plain">
[00:25.72]Kendime geldim geleli dostlar
[00:29.34]Olamam kimseye düşman
[00:32.58]Bi şüphem yok kefenim sağlam
[00:35.65]İçerim ben bu akşam
[00:40.47]
[00:51.23]Sesleri duydum duyalı dostlar
[00:54.93]Yola çıktın yeni baştan
[00:58.18]Acelem yok hedefim sağlam
[01:01.35]İçerim ben bu akşam
[01:05.15]İçerim ben bu akşam
[01:08.08]İçerim ben
[01:12.02]Ben burda bu akşam
[01:15.91]Ben burda bu akşam
[01:19.01]Ben burda bu akşam
[01:22.44]Ben burda bu akşam
[01:28.86]İçerim ben
[01:31.10]
[01:55.52]Sizleri gördüm göreli dostlar
[01:58.92]Hemen her gün bana bayram
[02:02.23]Yarınım yok sevenim sağlam
[02:05.31]İçerim ben bu akşam
[02:08.27]İçerim ben bu akşam
[02:11.12]İçerim ben
[02:13.33]
[02:17.03]Ben burda bu akşam
[02:19.83]Ben burda bu akşam
[02:23.08]Ben burda bu akşam
[02:26.05]Ben burda bu akşam
[02:32.59]İçerim ben bu akşam
[02:35.64]Ben burda bu akşam
[02:39.20]Ben burda bu akşam
[02:42.27]Ben burda bu akşam
[02:48.88]İçerim ben
[02:49.08]
  </script>"

  <script>
  // ===== LRC AYRIŞTIRICI =====
  function parseLRC(text) {
    if (!text) return [];
    const lines = text.replace(/\r\n?/g, "\n").split("\n");
    const events = [];
    const tsRe = /\[(\d+):(\d+)(?:[\.|:](\d+))?\]/g;
    for (const raw of lines) {
      const line = raw.trim();
      if (!line) continue;
      if (/^\[[a-zA-Z]+:/.test(line)) continue; // [ti:], [ar:], [al:] vb.

      let m; const stamps = [];
      while ((m = tsRe.exec(line)) !== null) {
        const mm = parseInt(m[1], 10) || 0;
        const ss = parseInt(m[2], 10) || 0;
        const frac = m[3] || "";
        let f = 0;
        if (frac) {
          if (frac.length === 2) f = parseInt(frac, 10) / 100;
          else if (frac.length === 3) f = parseInt(frac, 10) / 1000;
          else f = parseInt(frac, 10) / Math.pow(10, frac.length);
        }
        stamps.push(mm * 60 + ss + f);
      }
      const lyric = line.replace(tsRe, "").trim();
      if (!stamps.length) continue;
      for (const t of stamps) events.push({ time: t, text: lyric });
    }
    events.sort((a,b) => a.time - b.time);
    return events;
  }

  function findEventIndex(events, t) {
    let lo = 0, hi = events.length - 1, ans = -1;
    while (lo <= hi) {
      const mid = (lo + hi) >> 1;
      if (events[mid].time <= t) { ans = mid; lo = mid + 1; }
      else hi = mid - 1;
    }
    return ans;
  }

  // ===== OYNATICI VE GÖRÜNÜM =====
  const audio = document.getElementById('audio');
  const nowEl = document.getElementById('nowline');
  const nextEl = document.getElementById('nextline');
  const songSelect = document.getElementById('songSelect');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');

  let PLAYLIST = [];      // {id,title,audioSrc,lrcText,kind:'embedded'|'runtime'}
  let ACTIVE = -1;
  let ACTIVE_EVENTS = [];
  let rafId = null;

  function renderSelect() {
    songSelect.innerHTML = "";
    PLAYLIST.forEach((s, i) => {
      const opt = document.createElement('option');
      opt.value = i;
      opt.textContent = s.title;
      songSelect.appendChild(opt);
    });
    if (ACTIVE >= 0) songSelect.value = String(ACTIVE);
  }

  function loadSong(index) {
    if (index < 0 || index >= PLAYLIST.length) return;
    ACTIVE = index;
    const s = PLAYLIST[index];
    // Ses kaynağı
    audio.src = s.audioSrc;
    audio.load();
    // LRC
    ACTIVE_EVENTS = parseLRC(s.lrcText || "");
    // Başlık ipucu
    audio.title = s.title;
    // Seçimi yansıt
    renderSelect();
    // Görünümü sıfırla
    nowEl.textContent = "";
    nextEl.textContent = (ACTIVE_EVENTS[0] ? ACTIVE_EVENTS[0].text : "");
  }

  function step() {
    const t = audio.currentTime || 0;
    const idx = findEventIndex(ACTIVE_EVENTS, t);
    if (idx >= 0) {
      const cur = ACTIVE_EVENTS[idx];
      const next = ACTIVE_EVENTS[idx + 1];
      const t0 = cur.time;
      const t1 = (next ? next.time : (isFinite(audio.duration) ? audio.duration : t0 + 2));
      const span = Math.max(0.3, t1 - t0);
      const full = cur.text || "";
      const n = full.length;
      let shown = n;
      if (n > 0) {
        const progress = Math.max(0, Math.min(1, (t - t0) / span));
        shown = Math.floor(progress * n);
      }
      nowEl.textContent = full.slice(0, shown);
      nextEl.textContent = (next && next.text) ? next.text : "";
    } else {
      nowEl.textContent = "";
      nextEl.textContent = (ACTIVE_EVENTS[0] ? ACTIVE_EVENTS[0].text : "");
    }
    rafId = requestAnimationFrame(step);
  }

  audio.addEventListener('play', () => { if (rafId === null) rafId = requestAnimationFrame(step); });
  audio.addEventListener('pause', () => { if (rafId !== null) { cancelAnimationFrame(rafId); rafId = null; } });
  audio.addEventListener('ended', () => { if (rafId !== null) { cancelAnimationFrame(rafId); rafId = null; } });

  songSelect.addEventListener('change', () => {
    const idx = parseInt(songSelect.value, 10);
    loadSong(idx);
  });

  prevBtn.addEventListener('click', () => {
    if (!PLAYLIST.length) return;
    const idx = (ACTIVE - 1 + PLAYLIST.length) % PLAYLIST.length;
    loadSong(idx);
  });
  nextBtn.addEventListener('click', () => {
    if (!PLAYLIST.length) return;
    const idx = (ACTIVE + 1) % PLAYLIST.length;
    loadSong(idx);
  });

  // ===== BAŞLANGIÇTA GÖMÜLÜ (KALICI) ŞARKILARI EKLE =====
  // Burada kendi dosya adını ve LRC blok id'sini yaz.
  // Örnek: MP3 dosyasını index.html ile aynı klasöre koy ve adını yaz (ör. rock.mp3)
  const EMBEDDED = [
    // { title: "Rock That Body", audioSrc: "RockThatBody.mp3", lrcId: "lrc-rock-that-body" },
    { title: "Örnek Şarkı 1", audioSrc: "music1.mp3", lrcId: "lrc-example1" },
    { title: "Örnek Şarkı 2", audioSrc: "music2.mp3", lrcId: "lrc-example2" },
  ];
  EMBEDDED.forEach(e => {
    const el = document.getElementById(e.lrcId);
    if (!el) return;
    PLAYLIST.push({
      id: e.lrcId,
      title: e.title,
      audioSrc: e.audioSrc,     // örn: "audio/Parca.mp3" da olabilir
      lrcText: el.textContent || "",
      kind: "embedded"
    });
  });
  renderSelect();
  if (PLAYLIST.length) loadSong(0);

  // ===== DOSYADAN EKLE (GEÇİCİ) =====
  const addTitle = document.getElementById('addTitle');
  const addAudio = document.getElementById('addAudio');
  const addLrc   = document.getElementById('addLrc');
  const addBtn   = document.getElementById('addBtn');

  addBtn.addEventListener('click', async () => {
    const title = (addTitle.value || "").trim() || "Yeni Şarkı";
    const fAudio = addAudio.files && addAudio.files[0];
    const fLrc   = addLrc.files && addLrc.files[0];
    if (!fAudio || !fLrc) { alert("Lütfen MP3/WAV ve LRC dosyalarını seç."); return; }

    const audioURL = URL.createObjectURL(fAudio);
    const reader = new FileReader();
    reader.onload = () => {
      let txt = String(reader.result || "");
      txt = txt.replaceAll("</", "<\\/"); // güvenlik: </script> kaçır
      PLAYLIST.push({
        id: "runtime-" + Date.now(),
        title,
        audioSrc: audioURL,
        lrcText: txt,
        kind: "runtime"
      });
      renderSelect();
      loadSong(PLAYLIST.length - 1);
      // formu temizle
      addTitle.value = "";
      addAudio.value = "";
      addLrc.value = "";
    };
    reader.readAsText(fLrc, 'utf-8');
  });
  </script>
</body>
</html>
